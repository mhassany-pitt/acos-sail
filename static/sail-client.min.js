!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,(()=>(()=>{"use strict";var e={};return{156:function(e,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatefulSailAppClient=void 0;t.StatefulSailAppClient=function(e){var t=this,n=e,i=window.location.search,s=new URLSearchParams(i);if(n=!n&&s.get("env")?s.get("env"):"qa",this.env=n,this.serverPath="https://management.sailplatform.org/api/jsapp","qa"==n||"staging"==n)this.serverPath=this.serverPath.replace("//","//"+n+".");else if("prod"!=n)throw new Error("invalid value for 'env'. Must be one of ['qa','staging','prod']");if(this.username=s.get("username"),!this.username)throw new Error("missing username parameter");if(this.firstName=s.get("firstName"),!this.firstName)throw new Error("missing firstName parameter");if(this.lastName=s.get("lastName"),!this.lastName)throw new Error("missing lastName parameter");if(this.appId=s.get("appId"),!this.appId)throw new Error("missing appId parameter");if(this.sessionId=s.get("sessionId"),!this.sessionId)throw new Error("missing sessionId parameter");if(this.projectSlug=s.get("projectSlug"),!this.projectSlug)throw new Error("missing projectSlug parameter");if(this.taskSlug=s.get("taskSlug"),!this.taskSlug)throw new Error("missing taskSlug parameter");this.rubricSlug=s.get("rubricSlug");var o=function(e,t,r){fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){if(e.ok)return e.text();throw new Error("postData response was not ok")})).then((function(e){r(e)})).catch((function(e){alert("Invalid response from Sail(). Please contact admins if this error persists.\n["+e.message+"]")}))},a=function(e,r){var n=JSON.stringify(e),i=(new TextEncoder).encode(t.sessionId.substring(0,32)),s=window.crypto.getRandomValues(new Uint8Array(16)),o=(new TextEncoder).encode(n);window.crypto.subtle.importKey("raw",i,{name:"AES-CBC",length:256},!1,["encrypt"]).then((function(e){return window.crypto.subtle.encrypt({name:"AES-CBC",iv:s},e,o)})).then((function(e){var t=new Uint8Array(s.length+e.byteLength);t.set(s),t.set(new Uint8Array(e),s.length);var n=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return window.btoa(t)}(t);r(n)})).catch((function(e){console.error("Encryption error:",e)}))},u=function(e,r){var n=function(e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer}(e),i=n.slice(0,16),s=n.slice(16),o=(new TextEncoder).encode(t.sessionId.substring(0,32));return window.crypto.subtle.importKey("raw",o,{name:"AES-CBC",length:256},!1,["decrypt"]).then((function(e){return window.crypto.subtle.decrypt({name:"AES-CBC",iv:i},e,s)})).then((function(e){var t=(new TextDecoder).decode(e),n=JSON.parse(t);r(n)})).catch((function(e){console.error("Decryption error:",e)}))};this.getUsername=function(){return t.username},this.getFirstName=function(){return t.firstName},this.getLastName=function(){return t.lastName},this.getSessionId=function(){return t.sessionId},this.getProjectSlug=function(){return t.projectSlug},this.getTaskSlug=function(){return t.taskSlug},this.getRubricSlug=function(){return t.rubricSlug},this.getEnv=function(){return t.env},this.loadState=function(e){o(t.serverPath+"/load",{sessionId:t.sessionId},(function(t){u(t,(function(t){e(t)}))}))},this.saveState=function(e,r){a({state:e},(function(e){o(t.serverPath+"/save",{sessionId:t.sessionId,data:e},(function(e){u(e,(function(e){r&&r(e)}))}))}))};var c=[],f=null;this.logEvent=function(e,n){c.push(r(r({},e),{appId:t.appId,projectSlug:t.projectSlug,taskSlug:t.taskSlug,username:t.username,timestamp:(new Date).toISOString(),dataType:-1!=t.appId.indexOf("ITS")?"XML":"JSON"}));var i=function(){a({projectSlug:t.projectSlug,caliperObj:{data:c}},(function(e){o(t.serverPath+"/log",{sessionId:t.sessionId,data:e},(function(e){console.log("got back encrypted response"),u(e,(function(e){console.log("decrypted log return",e),n&&n(e)}))}))})),c.length=0,f=null};f&&clearTimeout(f),n?i():f=setTimeout(i,500)},this.submitGrade=function(e,n){if(!("taskSlug"in e))throw new Error("missing taskSlug parameter in submission");if(!("rubrics"in e))throw new Error("missing rubrics parameter in submission");e.rubrics.forEach((function(e,t){if(!("rubricSlug"in e))throw new Error("missing rubricSlug parameter in rubric#"+t);if(!("score"in e))throw new Error("missing score parameter in rubric#"+t)})),a(r({projectSlug:t.projectSlug},e),(function(e){o(t.serverPath+"/submitGrade",{sessionId:t.sessionId,data:e},(function(e){u(e,(function(e){n&&n(e)}))}))}))}}}}[156](0,e),e})()));
